# 標準ではインストールされていないパッケージを利用する

課題12のプログラムを書き換え、区切り文字列をタブ一つのみにしましょう。下記のように動作するプログラムを書いてください:

1. 「金額の合計」を「0」として、以下の処理を実行します。
2. **(A)** 標準入力から1行の入力を受け取ります。
3. 受け取った入力を、**タブ文字一つ**で区切った文字列のリストとして代入します。
4. 代入した文字列のリストの要素数が
    1. 「2」であれば、1つめの要素を「分類」、2つめの要素を「金額」が書かれた文字列として解釈して、「金額」を「金額の合計」に足して、再度**(A)**から実行します。
    2. 「1」でかつ、その要素が空文字列であれば、「金額の合計」を出力して、終了します。
    3. それ以外の場合は、「`Invalid input: <入力した文字列>`」という形式のメッセージを**例外としてスロー**し、終了します。

## 必要な知識

### `cabal install --lib`や`stack install`で外部のパッケージをインストールする

今回の課題では、文字列を任意の区切り文字列で分割できる、[Data.List.Split][1]というモジュールに入っている`splitOn`関数を使います。このモジュールは、[split][2]というパッケージに含まれるモジュールであり、splitパッケージはGHCをインストールしただけでは利用できません。追加でsplitパッケージをインストールする必要があります。

[1]: http://hackage.haskell.org/package/split-0.2.3.3/docs/Data-List-Split.html
[2]: http://hackage.haskell.org/package/split

インストールしていない状態で下記のように`import`を実行しても、`Could not find module ‘Data.List.Split’`などというエラーが出てきてしまいます。

```
ghci> import Data.List.Split

<no location info>: error:
    Could not find module ‘Data.List.Split’
    It is not a module in the current program, or in any known package.
```

というわけで、下記のように`cabal install --lib`コマンドを使ってパッケージをインストールしてみましょう:

```bash
> cabal install --lib split
Resolving dependencies...
Build profile: -w ghc-9.2.1 -O1
In order, the following will be built (use -v for more details):
 - split-0.2.3.4 (lib) (requires download & build)
Downloading  split-0.2.3.4
Downloaded   split-0.2.3.4
Starting     split-0.2.3.4 (lib)
Building     split-0.2.3.4 (lib)
Installing   split-0.2.3.4 (lib)
Completed    split-0.2.3.4 (lib)
```

※出力はご利用の環境や、すでにsplitパッケージをインストール済みか否かで変わりますのでご注意ください。

stackを使ってGHCをインストールした場合は下記のように`stack install`コマンドを使ってください:

```bash
shell> stack install split
split-0.2.3.3: configure
split-0.2.3.3: build
split-0.2.3.3: copy/register
```

※こちらも出力は環境や、すでにsplitパッケージをインストール済みか否かで変わります。

### インストールしたパッケージを利用出来る状態で、GHCなどを実行する

<!-- TODO: cabal new-execでも同じことが出来るはず -->

詳細な事情は後で解説しますので、ひとまず、下記のコマンドは、`stack install split`を実行したのと同じディレクトリーで実行してください。

```haskell
shell> stack exec ghci
```

今度は`Data.List.Split`モジュールを`import`出来るようになっているはずです。

```haskell
ghci> import Data.List.Split
```

文字列をタブで区切ってリストに変換するには、`Data.List.Split`モジュールに入った`splitOn`関数を次のように使います。第一引数に区切り文字（列）を、第二引数に分割したい文字列を与えましょう:

```haskell
ghci> splitOn "\t" "foo bar\tbaz"
["foo bar","baz"]
```

上記のとおり、文字列リテラルの中にタブ文字を書くには`\t`と書いてください。C言語などよくあるプログラミング言語と同様ですね。

引数の順番についても一点。第一引数ではなく第二引数に処理したい文字列を与える、という点に違和感を覚えた方もいらっしゃるかも知れません。実はこれはHaskellにおける関数全般で推奨されていることで、**主な処理対象である引数を最後**の引数にすることとなっています。他の多くのプログラミング言語とは逆の方針でしょうし、戸惑うのも無理はないでしょう。これにはHaskell固有の、ちゃんとしたメリットがあるのですが、申し訳なくもここでは詳細は割愛します。とにかくここでは、`splitOn`関数を含めHaskellの関数は、多くの場合「主な処理対象である引数を最後におく」ものだと覚えておいてください。

なお、`splitOn`は空文字列を与えたときの結果が`words`と異なるので注意しましょう:

```haskell
ghci> words ""
[]
ghci> splitOn "\t" ""
[""]
```

### パッケージがインストールされていることを確認する

以下は、当入門「Make Mistakes to Learn Haskell」を開発しているディレクトリーで実行した場合の出力です。

```
shell> stack exec ghc-pkg list
C:\Users\yuji-yamamoto\AppData\Local\Programs\stack\x86_64-windows\ghc-8.4.3\lib\package.conf.d
    Cabal-2.2.0.1
    Win32-2.6.1.0
    array-0.5.2.0
    base-4.11.1.0
    ... 省略 ...

C:\sr\snapshots\03cb0bbe\pkgdb
    ... 省略 ...
    split-0.2.3.3
    ... 省略 ...
```

出力結果には「パッケージデータベース」と呼ばれる、パッケージの情報が含まれるディレクトリーごとに、インストールされているパッケージの一覧が出力されます。  
先ほど`stack install split`コマンドを実行したので、splitパッケージが入っていますね。
