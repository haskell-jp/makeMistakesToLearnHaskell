# base以外のパッケージを利用する

課題12のプログラムを書き換え、区切り文字列をタブ一つのみしましょう。  
下記のように動作するプログラムを書いてください。

1. 「金額の合計」を「0」として、以下の処理を実行します。
2. **(A)** 標準入力から1行の入力を受け取ります。
3. 受け取った入力を、**タブ文字一つ**で区切った文字列のリストとして代入します。
4. 代入した文字列のリストの要素数が
    1. 「2」であれば、1つめの要素を「分類」、2つめの要素を「金額」が書かれた文字列として解釈して、「金額」を「金額の合計」に足して、再度**(A)**から実行します。
    2. 「0」であれば、「金額の合計」を出力して、終了します。
    3. それ以外の場合は、「`Invalid input: <入力した文字列>`」という形式のメッセージを**例外としてスロー**し、終了します。

## 必要な知識

### stack build で外部のパッケージをインストールする

文字列を任意の区切り文字列で分割できる、[Data.List.Split][1]というモジュールを使います。

[1]: http://hackage.haskell.org/package/split-0.2.3.3/docs/Data-List-Split.html

このモジュールは、[split][2]というパッケージに含まれるモジュールであり、splitパッケージは標準ではインストールされていません、つまり、GHCをインストールしただけでは入っていないのです。

[2]: http://hackage.haskell.org/package/split

インストールしていない状態で下記のように`import`を実行しても、`Could not find module ‘Data.List.Split’`などというエラーが出てしまいます。

```
ghci> import Data.List.Split
```

<!-- TODO: エラーメッセージをコピペ -->

Haskellで外部のパッケージをインストール

<!-- TODO: cabal new-buildも？ -->

```
shell> stack build split
split-0.2.3.3: configure
split-0.2.3.3: build
split-0.2.3.3: copy/register
```

[Hackage][3]というウェブサイトに掲載されている、splitというパッケージをインストールします。

[3]: http://hackage.haskell.org/

### インストールしたパッケージを利用出来る状態で、GHCなどを実行する

<!-- TODO: cabal new-execでも同じことが出来るはず -->

詳細な事情は後で解説しますので、ひとまず、`stack build split`を実行したのと同じディレクトリーで、下記のコマンドを実行してください。

```haskell
shell> stack exec ghci
```

今度は`Data.List.Split`モジュールを`import`出来るようになっているはずです。

```haskell
ghci> import Data.List.Split
```

文字列をタブで区切ってリストに変換するには

```haskell
ghci> splitOn "\t" "foo bar\tbaz"
["foo bar","baz"]
```

空文字列を与えたときの結果が、`words`と異なるので注意しましょう。

```haskell
ghci> words ""
[]
ghci> splitOn "\t" ""
[""]
```

### stackの仕組みと歴史を簡単に

#### stack以前

stackというツールが出来る前は、**（古い）**cabal-installというツールを使用していたのですが、今回のように外部パッケージをインストールすることが、非常に面倒な作業になってしまうことがしばしばありました。  
このcabal-installやGHC標準のパッケージ管理システムの仕様上、パッケージの依存関係をうまく解決できず、インストールに失敗してしまう、と言うことがしばしばあったのです。  
このような状態は「[Cabal Hell][4]」と呼ばれ、Haskellを本格的に使用する上での頭の痛い問題として、長年立ちはだかってきました。

[4]: http://www.well-typed.com/blog/2014/09/how-we-might-abolish-cabal-hell-part-1/

#### Stackageとstackの誕生

そうした問題を解決するため、[Stackage][5]というウェブサイトが作られました。  
Stackageでは、「必ず一緒にビルドできる組み合わせのパッケージの一覧」を[こちらのリポジトリー][6]で管理しています。  
都度こちらの一覧に書かれたパッケージをまとめてビルドしてみることで、実際にビルドできるバージョンを調べています。  
そうしてまとめられた「必ず一緒にビルドできる組み合わせのパッケージの一覧」を「LTS Haskell」と呼んで、

[5]: https://www.stackage.org/
[6]: https://github.com/commercialhaskell/stackage/

同じstack.yamlが書かれたディレクトリー内では、そのパッケージが使える。
