# `do`ã«ãŠã‘ã‚‹å¤‰æ•°ã¸ã®ä»£å…¥ã‚’æŠ‘ãˆã‚‹ 1

èª²é¡Œ4ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã€`<-`ã‚‚ã‚«ãƒƒã‚³ã‚‚ä½¿ã‚ãšã«æ›¸ãæ›ãˆã¾ã—ã‚‡ã†ã€‚ä»Šå›ã‚‚&ç´”ç²‹ã«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚’ã—ã¦ãã ã•ã„ã€‚ç‰¹ã«æŒ¯ã‚‹èˆã„ã‚’å¤‰ãˆã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

## å¿…è¦ãªçŸ¥è­˜

ä»Šå›ã¯ã€ã“ã‚Œã¾ã§ã€Œå‘½ä»¤ã€ã‚’åˆ—æŒ™ã—ãŸã‚Š`<-`ã§ã€Œå‘½ä»¤ã€ã‹ã‚‰çµæœã‚’å¤‰æ•°ã«ä»£å…¥ã™ã‚‹ã®ã«ç”¨ã„ã¦ã„ãŸã€Œ`do`è¨˜æ³•ã€ãŒå„ã€Œå‘½ä»¤ã€ã‚’ã©ã®ã‚ˆã†ã«å‡¦ç†ã—ã¦ã„ã‚‹ã®ã‹ã‚’çŸ¥ã‚‹ã“ã¨ã§ã€`do`è¨˜æ³•ã‚’ä½¿ã‚ãšã«æ›¸ãæ›ãˆã‚‹æ–¹æ³•ã‚’å­¦ã³ã¾ã™ã€‚å‰ã®èª²é¡Œã¨åŒæ§˜ã€Haskellã‚’æ›¸ãã¨ãã«å¿…ãšã—ã‚‚ã“ã®çŸ¥è­˜ã‚’ä½¿ã†å¿…è¦ã¯ãªã„ã§ã™ãŒï¼ˆå®Ÿéš›ã€å¤šãã®å ´åˆ`do`è¨˜æ³•ã®æ–¹ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã§ã™ã—ï¼‰ã€ã‚ã®ã€Œãƒ¢ãƒŠãƒ‰(`Monad`)ã€ã‚’ç†è§£ã™ã‚‹ä¸Šã§å¿…è¦ä¸å¯æ¬ ãªçŸ¥è­˜ã¨ãªã£ã¦ã„ã¾ã™ã®ã§ã€æ˜¯éç†è§£ã—ã¦ãŠã„ã¦ãã ã•ã„ã€‚

### `do`è¨˜æ³•ã®æ­£ä½“1: `do`ã‚’ãªãã™`>>`

ã¾ãšã¯ã€æ¬¡ğŸ‘‡ã®ã‚ˆã†ã«`do`è¨˜æ³•ã‚’ä½¿ã£ã¦`putStrLn`ã‚’é€£ç¶šã—ã¦å®Ÿè¡Œã™ã‚‹é–¢æ•°ã‚’ã€`do`è¨˜æ³•ã‚’ä½¿ã‚ãšã«æ›¸ãæ›ãˆã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™:

```haskell
loremIpsum = do
    putStrLn "Lorem ipsum dolor sit amet,"
    putStrLn "consectetur adipiscing elit,"
    putStrLn "sed do eiusmod tempor incididunt"
    putStrLn "ut labore et dolore magna aliqua."
```

çµè«–ã‹ã‚‰è¨€ã„ã¾ã—ã‚‡ã†ã€‚ä¸Šè¨˜ğŸ‘†ã®ã‚³ãƒ¼ãƒ‰ã‹ã‚‰`do`ã‚’ãªãã™ã¨ã€ä¸‹è¨˜ğŸ‘‡ã®ã‚ˆã†ã«æ›¸ãæ›ãˆã‚‰ã‚Œã¾ã™:

```haskell
loremIpsum =
    putStrLn "Lorem ipsum dolor sit amet,"
    >> putStrLn "consectetur adipiscing elit,"
    >> putStrLn "sed do eiusmod tempor incididunt"
    >> putStrLn "ut labore et dolore magna aliqua."
```

`do`ã‚’æ¶ˆã—ãŸä¸Šã§ã€æœ€åˆã®è¡Œã‚’é™¤ã„ã¦å„è¡Œã®é ­ã«`>>`ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚`>>`ã¯ã€`putStrLn ".."`ã®ã‚ˆã†ãªã€Œå‘½ä»¤ã€ã‚’ã€Œç¹‹ã’ã‚‹ã€æ¼”ç®—å­ã§ã™ã€‚å½“ç„¶ã€`+`ã‚„`*`ã®ã‚ˆã†ãªã€Haskellã«ãŠã‘ã‚‹ä»–ã®æ¼”ç®—å­ã¨å…¨ãåŒã˜ã‚ˆã†ã«æ‰±ãˆã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

å¾“ã£ã¦`>>`ã‚‚ã€æ¬¡ã®ã‚ˆã†ã«å·¦è¾ºã‚‚å³è¾ºã‚‚å«ã‚ã¦1è¡Œã§æ›¸ãã“ã¨ãŒã§ãã¾ã™:

```haskell
loremIpsum =
    putStrLn "Lorem ipsum dolor sit amet," >> putStrLn "consectetur adipiscing elit," >> putStrLn "sed do eiusmod tempor incididunt" >> putStrLn "ut labore et dolore magna aliqua."
```

ä¸€ã¤ã‚„äºŒã¤ãªã‚‰ã¨ã‚‚ã‹ãã€ã“ã“ã¾ã§å¤šãã®ã€Œå‘½ä»¤ã€ã‚’ç¹‹ã’ã‚‹ã¨èª­ã¿ã¥ã‚‰ããªã£ã¦ã—ã¾ã„ã¾ã™ãŒğŸ˜…ã€‚

é€šå¸¸ã€Haskellã®`do`ã«ãŠã„ã¦æ¬¡ğŸ‘‡ã®ã‚ˆã†ã«æ›¸ã„ãŸå ´åˆã€

```haskell
do
    action1
    action2
    action3
```

ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã®éš›ã€æ¬¡ğŸ‘‡ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã«å†…éƒ¨ã§ç½®ãæ›ãˆã‚‰ã‚Œã¾ã™:

```haskell
action1 >> action2 >> action3
```

ã“ã®ã‚ˆã†ãªç½®ãæ›ãˆãŒè¡Œã‚ã‚Œã‚‹ã“ã¨ã‹ã‚‰ã€`do`ã¯`>>`ã®ã€Œç³–è¡£æ§‹æ–‡(syntax sugar)ã€ã§ã‚ã‚‹ã€ã¨ã‚‚è¨€ã„ã¾ã™ã€‚èª²é¡Œhoge(9?)ã§ç´¹ä»‹ã—ãŸã€ãƒªã‚¹ãƒˆã‚’æ›¸ãã¨ãã®äºŒã¤ã®è¨˜æ³•ï¼ˆä¾‹ãˆã°`[a, b, c]`ã¨`a : b : c : []`ï¼‰ã®é–¢ä¿‚ã¨åŒã˜ã§ã™ã€‚

#### å‹ã§çŸ¥ã‚‹`>>`

Haskellã«ãŠã‘ã‚‹`>>`ã¯æ¼”ç®—å­ãªã®ã§ã€`:t`ã‚’ä½¿ãˆã°ã©ã‚“ãªå‹ã‹ãŒåˆ†ã‹ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚æ—©é€Ÿè¦‹ã¦ã¿ã¾ã—ã‚‡ã†:

```haskell
ghci> :t (>>)
(>>) :: Monad m => m a -> m b -> m b
```

`Monad`ãŒå‡ºã¦ãã¾ã—ãŸã€‚ãã†ã€ã‚ã®ã€Œãƒ¢ãƒŠãƒ‰(`Monad`)ã€ã§ã™ã€‚æˆ‘ã€…ã¯ã“ã‚Œã¾ã§`IO`å‹ã®ã€Œå‘½ä»¤ã€ã®è©±ã‚’ã—ã¦ã„ãŸã¯ãšãªã®ã«ä¸€ä½“ãªãœã“ã“ã§`Monad`ãŒå‡ºã¦ããŸã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

ã©ã†ã„ã†ç†ç”±ã§ã‚ã‚Œã€`=>`ã®å·¦è¾ºã«å‡ºã¦ãã‚‹ã¨è¨€ã†ã“ã¨ã¯`Monad`ã¯å‹ã‚¯ãƒ©ã‚¹ã®ã‚ˆã†ã§ã™ã€‚GHCiã®`:i`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦èª¿ã¹ã¦ã¿ã¾ã—ã‚‡ã†:

```haskell
ghci> :i Monad
class Applicative m => Monad (m :: * -> *) where
  (>>=) :: m a -> (a -> m b) -> m b
  (>>) :: m a -> m b -> m b
  return :: a -> m a
  fail :: String -> m a
  {-# MINIMAL (>>=) #-}
        -- Defined in â€˜GHC.Baseâ€™
instance Monad (Either e) -- Defined in â€˜Data.Eitherâ€™
instance Monad [] -- Defined in â€˜GHC.Baseâ€™
instance Monad Maybe -- Defined in â€˜GHC.Baseâ€™
instance Monad IO -- Defined in â€˜GHC.Baseâ€™
instance Monad ((->) r) -- Defined in â€˜GHC.Baseâ€™
instance Monoid a => Monad ((,) a) -- Defined in â€˜GHC.Baseâ€™
```

ä½•ã ã‹ãŸãã•ã‚“å‡ºåŠ›ã•ã‚Œã¾ã—ãŸã­ï¼ã“ã“ã§æ³¨ç›®ã—ã¦æ¬²ã—ã„ã®ã¯ã€æœ€å¾Œã®æ–¹ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹ã€

```haskell
instance Monad IO -- Defined in â€˜GHC.Baseâ€™
```

ã¨ã„ã†è¡Œã§ã™ã€‚ã“ã‚Œã¯ã€`IO`å‹ãŒ`Monad`å‹ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¾ã§ä½•åº¦ã‚‚ä½¿ã£ã¦ããŸ`IO`å‹ã€æœ¬å…¥é–€ã®è¨€è‘‰ã§è¨€ã†ã¨ã“ã‚ã®ã€Œå‘½ä»¤ã€ã¯`Monad`ã®ä¸€ã¤ãªã®ã§ã™ã€‚

ãã—ã¦ã€å‰è¿°ã®GHCiã®`:i Monad`ã®çµæœã‹ã‚‰å¯Ÿã›ã‚‰ã‚Œã‚‹ã¨ãŠã‚Šã€`Monad`å‹ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ä»–ã«ã‚‚ãŸãã•ã‚“ã‚ã‚‹ã“ã¨ã‚‚ã€é ­ã®ç‰‡éš…ã«ç½®ã„ã¦ãŠã„ã¦ä¸‹ã•ã„ã€‚ä»–ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã¤ã„ã¦ã¯æ¬¡ã®æ¬¡ã®èª²é¡Œhoge(21?)ã§è§¦ã‚Œã¾ã™ã®ã§ã€ä¹ã†ã”æœŸå¾…ã€‚

ã“ã“ã¾ã§ã®ãƒã‚¤ãƒ³ãƒˆã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™:

- `Monad`ã¯å‹ã‚¯ãƒ©ã‚¹
- `>>`ã¯ã€`Monad`å‹ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å…¨èˆ¬ã«å¯¾ã—ã¦ä½¿ãˆã‚‹é–¢æ•°ï¼ˆæ¼”ç®—å­ï¼‰
- ä»Šã¾ã§ä½¿ã£ã¦ããŸã€`putStrLn`ã‚„`getLine`ãŒè¿”ã™`IO`ï¼ˆå‘½ä»¤ï¼‰ã‚‚`Monad`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹

##### GHCã®è¨€èªæ‹¡å¼µ`TypeApplications`ã§ã€åˆ†ã‹ã‚Šã‚„ã™ãè¦‹ã¦ã¿ã‚‹

`>>`ã¯`Monad`å‹ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å…¨èˆ¬ã«å¯¾ã—ã¦ä½¿ãˆã‚‹é–¢æ•°ã§ã€`IO`å‹ã‚‚`Monad`å‹ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãªã®ã§`>>`ãŒä½¿ãˆã‚‹ã“ã¨ã¯ã“ã“ã¾ã§ã§ãŠä¼ãˆã—ãŸã¨ãŠã‚Šã§ã™ã€‚ã¨ã¯è¨€ã£ãŸã‚‚ã®ã®ã€`>>`ã®ã“ã¨ã‚’ã‚ˆã‚Šã‚ˆãç†è§£ã™ã‚‹ä¸Šã§ã€`Monad m => m a -> m b -> m b`ã¨ã„ã†å‹ã¯å°‘ã€…æŠ½è±¡çš„ã§åˆ†ã‹ã‚Šã¥ã‚‰ãæ„Ÿã˜ã‚‰ã‚Œã‚‹ã‹ã‚‚çŸ¥ã‚Œã¾ã›ã‚“ã€‚ãã“ã§ã€`TypeApplications`ã¨ã„ã†GHCã®è¨€èªæ‹¡å¼µã‚’ä½¿ã†ã“ã¨ã§ã€`IO`å°‚ç”¨ã®`>>`ã‚’ä½œã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚`Monad`ã®ã“ã¨ã‚’æ„è­˜ã—ãªãã¦è‰¯ã„åˆ†ã€ã‚ˆã‚Šåˆ†ã‹ã‚Šã‚„ã™ããªã‚‹ã¯ãšã§ã™ã€‚

###### ãã‚‚ãã‚‚è¨€èªæ‹¡å¼µã¨ã¯ï¼Ÿ

ã€ŒGHCã®è¨€èªæ‹¡å¼µã€ã¨ã¯ä½•ã§ã—ã‚‡ã†ã‹ï¼ŸGHCãŒæä¾›ã™ã‚‹ã€ç¾è¡Œã®Haskellã®ä»•æ§˜[Haskell 2010][1]ã§ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ã€å®Ÿé¨“çš„ãªæ©Ÿèƒ½ã§ã™ã€‚é€šå¸¸ã€ä¸‹è¨˜ã®ã‚ˆã†ãªç‰¹åˆ¥ãªå½¢å¼ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã€`.hs`ãƒ•ã‚¡ã‚¤ãƒ«ã«ãŠã‘ã‚‹ä¸€ç•ªæœ€åˆã®ç®‡æ‰€ã«æ›¸ãã“ã¨ã§ã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­ã§ã®ã¿æŒ‡å®šã—ãŸè¨€èªæ‹¡å¼µï¼ˆä¸‹è¨˜ã®ä¾‹ã¯`TypeApplications`ï¼‰ã‚’æœ‰åŠ¹ã«ã—ã¦ä½¿ã„ã¾ã™:

[1]: https://www.haskell.org/onlinereport/haskell2010/

```haskell
{-# LANGUAGE TypeApplications #-}
```

ã‚ã‚‹ã„ã¯ã€GHCiã§è¨€èªæ‹¡å¼µã‚’æœ‰åŠ¹ã«ã—ãŸã„å ´åˆã€â†“ã®ã‚ˆã†ã«æ›¸ãã“ã¨ã§`TypeApplications`ã‚’æœ‰åŠ¹ã«ã§ãã¾ã™ã€‚

```haskell
ghci> :set -XTypeApplications
```

`-XTypeApplications`ã¨ã‚ã‚‹ã¨ãŠã‚Šã€`-X`ã¨`TypeApplications`ã®é–“ã«ã‚¹ãƒšãƒ¼ã‚¹ãŒãªã„ç‚¹ã«ã”æ³¨æ„ãã ã•ã„ã€‚ã‚¹ãƒšãƒ¼ã‚¹ã‚’æ›¸ãã¨ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã—ã¾ã„ã¾ã™:

```haskell
ghci> :set -X TypeApplications
Some flags have not been recognized: -X, TypeApplications
```

GHCiã‚’èµ·å‹•ã—ã¦ã„ã‚‹é–“ã«è¨€èªæ‹¡å¼µã‚’**ç„¡åŠ¹**ã«ã—ãŸããªã£ãŸå ´åˆã€ä¸‹è¨˜ã®ã‚ˆã†ã«æ›¸ãã¾ã™:

```haskell
ghci> :set -XNoTypeApplications
-- ã‚‚ã¡ã‚ã‚“ä¾‹ã¯ TypeApplications ã§ã™ãŒã€ä»–ã®è¨€èªæ‹¡å¼µã‚‚åŒæ§˜ã§ã™
```

###### `TypeApplications`ã‚’ä½¿ã†

ã„ã‚ˆã„ã‚ˆã€`TypeApplications`ã‚’ä½¿ã£ã¦ã¿ã¾ã—ã‚‡ã†:

```haskell
ghci> :set -XTypeApplications
```

ã“ã“ã§ã¯ä¾‹ã¨ã—ã¦ã€`map`é–¢æ•°ã«`TypeApplications`ã‚’ä½¿ã£ã¦ã¿ã¾ã™:

```haskell
ghci> :t map
map :: (a -> b) -> [a] -> [b]
```

`map`é–¢æ•°ã¯ã€ä¸ŠğŸ‘†ã®`:t`ã‚³ãƒãƒ³ãƒ‰ã®çµæœã®é€šã‚Šã€`a`ã¨`b`ã¨ã„ã†äºŒã¤ã®å‹å¤‰æ•°ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚`TypeApplications`ã‚’ä½¿ãˆã°ã€ãã‚Œãã‚Œã®å‹å¤‰æ•°ã‚’æ‰‹å‹•ã§ä»£å…¥ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€æ¬¡ã®ã‚ˆã†ã«`map @Bool @String`ã¨æ›¸ãã¨ã€å‹å¤‰æ•°`a`ã«`Bool`ã€å‹å¤‰æ•°`b`ã«`String`ã‚’ä»£å…¥ã—ãŸ`map`é–¢æ•°ãŒå‡ºæ¥ä¸ŠãŒã‚Šã¾ã™:

```haskell
ghci> :t map @Bool @String
map @Bool @String :: (Bool -> String) -> [Bool] -> [String]
```

é€šå¸¸ã€ã“ã®ã€å‹å¤‰æ•°ã«å…·ä½“çš„ãªå‹ã‚’ä»£å…¥ã™ã‚‹å‡¦ç†ã¯å‹æ¨è«–ã«ã‚ˆã£ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«è‡ªå‹•ã§è¡Œã‚ã‚Œã¾ã™ãŒã€`TypeApplications`ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªã‚‰åˆ¶å¾¡ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã®ã§ã™ã€‚

`TypeApplications`ã§ä½œã‚‰ã‚ŒãŸ`map @Bool @String`ã¯ã€`Bool`å‹ã®ãƒªã‚¹ãƒˆã‚’å—ã‘å–ã£ã¦ã€ãã®å„è¦ç´ ã«`Bool -> String`é–¢æ•°ã‚’é©ç”¨ã—ã€`String`å‹ã®ãƒªã‚¹ãƒˆã‚’è¿”ã™ã€å°‚ç”¨ã®é–¢æ•°ã¨ãªã£ã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã€hoge

```
ghci> :t map @Bool
map @Bool :: (Bool -> b) -> [Bool] -> [b]
ghci> map @Bool length ["aaa", "bb", "cccc"]

<interactive>:8:11: error:
    ? Couldn't match type â€˜Boolâ€™ with â€˜[a0]â€™
      Expected type: Bool -> Int
        Actual type: [a0] -> Int
    ? In the second argument of â€˜mapâ€™, namely â€˜lengthâ€™
      In the expression: map @Bool length ["aaa", "bb", "cccc"]
      In an equation for â€˜itâ€™:
          it = map @Bool length ["aaa", "bb", "cccc"]

<interactive>:8:19: error:
    ? Couldn't match expected type â€˜Boolâ€™ with actual type â€˜[Char]â€™
    ? In the expression: "aaa"
      In the third argument of â€˜mapâ€™, namely â€˜["aaa", "bb", "cccc"]â€™
      In the expression: map @Bool length ["aaa", "bb", "cccc"]

<interactive>:8:26: error:
    ? Couldn't match expected type â€˜Boolâ€™ with actual type â€˜[Char]â€™
    ? In the expression: "bb"
      In the third argument of â€˜mapâ€™, namely â€˜["aaa", "bb", "cccc"]â€™
      In the expression: map @Bool length ["aaa", "bb", "cccc"]

<interactive>:8:32: error:
    ? Couldn't match expected type â€˜Boolâ€™ with actual type â€˜[Char]â€™
    ? In the expression: "cccc"
      In the third argument of â€˜mapâ€™, namely â€˜["aaa", "bb", "cccc"]â€™
      In the expression: map @Bool length ["aaa", "bb", "cccc"]
```

ä»Šå›ã¯ã€`Monad`ã®ã“ã¨ã‚’è€ƒãˆãªã„ãŸã‚ã«ã€`(>>)`ã®`m`ã‚’`TypeApplications`ã§`IO`ã«ç½®ãæ›ãˆã¦è¦‹ã¦ã¿ã‚‹ã®ã«ä½¿ã„ã¾ã—ã‚‡ã†ã€‚

```
ghci> :t (>>) @IO
(>>) @IO :: IO a -> IO b -> IO b
```

2ã¤ã®å¼•æ•°ã¨æˆ»ã‚Šå€¤:

- ç¬¬1å¼•æ•°ï¼ˆå·¦è¾ºï¼‰ã®`IO a`: `getLine`ã‚„`putStrLn "hello"`ãªã©ã®å‘½ä»¤ã€‚
- ç¬¬2å¼•æ•°ï¼ˆå³è¾ºï¼‰ã®`IO b`: åŒã˜ã`getLine`ã‚„`putStrLn "hello"`ãªã©ã®å‘½ä»¤ã€‚
- æˆ»ã‚Šå€¤ã®`IO b`: ç¬¬2å¼•æ•°ï¼ˆå³è¾ºï¼‰ã®å‘½ä»¤ã¨ã€åŒã˜å‹ã®å€¤ã‚’è¿”ã™å‘½ä»¤ã€‚

ã€Œå³è¾ºã®å‘½ä»¤ã®çµæœã‚’ãã®ã¾ã¾è¿”ã™å‘½ä»¤ã€ã‚’è¿”ã™ã“ã¨ãŒèª­ã¿å–ã‚Œã‚‹ã€‚  
ä¾‹ãˆã°

```
ask =
    putStrLn "Hello, how are you?"
    >> getLine
```

ã¨æ›¸ãã¨ã€`putStrLn "Hello, how are you?"`ã¨`getLine`ã‚’ç¶šã‘ã¦å®Ÿè¡Œã—ã¦ã€`getLine`ã®å®Ÿè¡Œçµæœã‚’è¿”ã™å‘½ä»¤ãŒä½œã‚‰ã‚Œã‚‹ã€‚

```
ghci> ask
Hello, how are you?
Fine! -- ã“ã“ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹å…¥åŠ›
"Fine!"
```

`do`ã‚’ä½¿ã£ã¦ã‚„ã£ã¦ã‚‚ã‚„ã£ã±ã‚ŠåŒã˜ã€‚

```
ghci> :{
ghci| ask = do
ghci|     putStrLn "Hello, how are you?"
ghci|     getLine
ghci| :}
ghci> ask
Hello, how are you?
Alright. -- ã“ã“ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹å…¥åŠ›
"Alright."
```

ã¾ã¨ã‚ã‚‹ã¨ã€`>>`ã¯ã€ã€Œä¸¡è¾ºã®å‘½ä»¤ã‚’ç¶šã‘ã¦å®Ÿè¡Œã—ã¦ã€å³è¾ºã®å‘½ä»¤ã®çµæœã‚’è¿”ã™å‘½ä»¤ã€ã‚’ä½œã‚‹æ¼”ç®—å­ã€‚  
ã»ã‹ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã§ã‚ˆãå‡ºã¦ãã‚‹ã‚»ãƒŸã‚³ãƒ­ãƒ³ `;`ã¨ã‚ˆãä¼¼ã¦ã‚‹ã€‚

### `do`è¨˜æ³•ã®æ­£ä½“2: `<-`ã‚’ãªãã™ `>>=`

ä»Šåº¦ã¯`do`ã®ä¸­ã§å˜ã«å‘½ä»¤ã‚’åˆ—æŒ™ã™ã‚‹å‡¦ç†ã ã‘ã§ãªãã€`do`ã®ä¸­ã§`<-`ã‚’ä½¿ã£ã¦å¤‰æ•°ã«ä»£å…¥ã‚’ã™ã‚‹å‡¦ç†ã‚’ã€`do`ã‚’ä½¿ã‚ãªã„ã§æ›¸ãæ›ãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```
echo = do
  line <- getLine
  putStrLn line
```

â†“ã®ã‚ˆã†ã«ç½®ãæ›ãˆã‚‰ã‚Œã‚‹ï¼

```
echo = getLine >>= putStrLn
```

1è¡Œã ã‘ã€‚ã¾ãŸã—ã¦ã‚‚`do`ãŒãªã„ï¼  
`>>=`ã¨ã¯ä½•è€…ï¼Ÿ

```
ghci> :t (>>=)
(>>=) :: Monad m => m a -> (a -> m b) -> m b
```

ã¾ãŸ`Monad`ãŒå‡ºã¦ããŸã®ã§ã€`TypeApplications`ã§`IO`ã«ç½®ãæ›ãˆã¦ã¿ã‚‹ã€‚

```
ghci> :t (>>=) @IO
(>>=) @IO :: IO a -> (a -> IO b) -> IO b
```

`>>`ã¨é•ã£ã¦ç¬¬äºŒå¼•æ•°ãŒé–¢æ•°`a -> IO b`ã«ãªã£ã¦ã„ã‚‹ã®ãŒãƒã‚¤ãƒ³ãƒˆã€‚

2ã¤ã®å¼•æ•°ã¨æˆ»ã‚Šå€¤:

- `IO a`: ç¬¬äºŒå¼•æ•°ã®é–¢æ•°`a -> IO b`ã®ã€**å¼•æ•°**ã¨åŒã˜å‹`a`ã®å€¤ã‚’è¿”ã™`IO`ï¼ˆå‘½ä»¤ï¼‰ã€‚
- `a -> IO b`: ä½•ã‹ï¼ˆ`IO`ã§ãªã„ã€æ™®é€šã®ï¼‰å€¤`a`ã‚’å—ã‘å–ã£ã¦ã€å‘½ä»¤`IO b`ã‚’è¿”ã™ã€‚
- `IO b`: ç¬¬äºŒå¼•æ•°ã®é–¢æ•°`a -> IO b`ã®ã€**çµæœ**ã¨åŒã˜å‹`b`ã®å€¤ã‚’è¿”ã™`IO`ï¼ˆå‘½ä»¤ï¼‰ã€‚

ã€Œå·¦è¾ºã®å‘½ä»¤ã®å®Ÿè¡Œçµæœã‚’å—ã‘å–ã£ã¦ã€å³è¾ºã®ã€å‘½ä»¤ã‚’è¿”ã™é–¢æ•°ã€ã«ã¤ãªã’ã¦ã€ç¶šã‘ã¦å®Ÿè¡Œã™ã‚‹å‘½ä»¤ã€ã‚’è¿”ã™æ¼”ç®—å­

```
echo = getLine >>= putStrLn
```

ä¸¡è¾ºã®å‹ã‚’èª¿ã¹ã¦ã¿ã‚‹ã¨

```
ghci> :t getLine
getLine :: IO String
```

å·¦è¾ºã«å½“ãŸã‚‹`getLine`ãŒçµæœã¨ã—ã¦`String`ã‚’è¿”ã—ã¦ã€

```
ghci> :t putStrLn
putStrLn :: String -> IO ()
```

å³è¾ºã«å½“ãŸã‚‹`putStrLn`ã®å¼•æ•°ã¨ã—ã¦æ¸¡ã™ã€‚

æœ€çµ‚çš„ã«`putStrLn`ãŒè¿”ã™ã®ã¯`IO ()`ãªã®ã§ã€`echo`ã®å‹ã¯`IO ()`ã¨ãªã‚‹ã€‚

```
ghci> echo = getLine >>= putStrLn
ghci> :t echo
echo :: IO ()
```

ã§ã‚‚ã“ã‚Œâ†“ã¯ãƒ€ãƒ¡

```
ghci> getLine >>= length

<interactive>:4:13: error:
    ? Couldn't match type â€˜Intâ€™ with â€˜IO bâ€™
      Expected type: String -> IO b
        Actual type: [Char] -> Int
    ? In the second argument of â€˜(>>=)â€™, namely â€˜lengthâ€™
      In the expression: getLine >>= length
      In an equation for â€˜itâ€™: it = getLine >>= length
    ? Relevant bindings include it :: IO b (bound at <interactive>:4:1)
```

ã‚ãã¾ã§ã‚‚ã€`>>=`ã®å³è¾ºã«æ¸¡ã•ã‚Œã‚‹ã®ã¯`IO`ï¼ˆå‘½ä»¤ï¼‰ã‚’è¿”ã™é–¢æ•°

`length`ã®ã‚ˆã†ãªç´”ç²‹ãªé–¢æ•°ã‚’`>>=`ã«æ¸¡ã™ã«ã¯ã€`return`ãªã©ã§ã€`IO`ã«å¤‰æ›ã—ãªã„ã¨ã„ã‘ãªã„ã€‚

```
ghci> getLine >>= return . length
12345 -- ã“ã“ã¯è‡ªåˆ†ã§å…¥åŠ›ã—ãŸè¡Œã€‚
5
```

ãƒ©ãƒ ãƒ€æŠ½è±¡ã§ç½®ãæ›ãˆã‚‹ã¨ã“ã†â†“

```
getLine >>= (\line -> return (length line))
```

`do`ã§æ›¸ãæ›ãˆã‚‹ã¨ã“ã†â†“

```
do
    line <- getLine
    return (length line)
```

ã“ã®ã¨ãŠã‚Šã€å®Ÿéš›ã«`do`è¨˜æ³•ã®ä¸­ã§`<-`ã‚’ä½¿ã£ãŸå ´åˆã€ä¾‹ãˆã°ä¸Šè¨˜ã®ã€Œ`line <- getLine`ã€ã§å§‹ã¾ã‚‹2è¡Œã¯ã€ãã®å‰ã®`getLine >>= (\line -> return (length line))`ã¨ã„ã†å¼ã«ç½®ãæ›ãˆã‚‰ã‚Œã‚‹ï¼ˆ`do`ã«ãŠã‘ã‚‹`<-`ã¯`>>=`ã®ç³–è¡£æ§‹æ–‡ï¼‰ã€‚

`return`ã§ã¯ãªãã€`print`ã§`IO`ã«å¤‰ãˆã¦ã‚‚å‹ãƒã‚§ãƒƒã‚¯ã¯é€šã‚‹ï¼

```
getLine >>= print . length
```

æ™®é€šã®ç´”ç²‹ãªé–¢æ•°ã‚’ä½¿ã£ã¦ã„ã‚‹å ´é¢ã§ã‚‚ã£ã¨æ°—è»½ã«ã€`return`ã‚’ä½¿ã‚ãšã«`do`ã‚’æ¶ˆã™æ–¹æ³•ã¯æ¬¡ã®èª²é¡Œã§ï¼

### ç•ªå¤–ç·¨: ä»–ã«ã‚ˆãä½¿ã‚ã‚Œã‚‹`do`ã‚’æ¶ˆã™ãŸã‚ã«ä½¿ã†é–¢æ•°

```
ghci> :t (=<<)
(=<<) :: Monad m => (a -> m b) -> m a -> m b

ghci> :t (=<<) @IO
(=<<) @IO :: (a -> IO b) -> IO a -> IO b
```

`>>=`ã®å¼•æ•°ã®é †ç•ªã‚’é€†ã«ã—ãŸã ã‘ï¼  
ã€Œå³è¾ºã®`IO a`ã®å®Ÿè¡Œçµæœã‚’å·¦è¾ºã®é–¢æ•°`a -> IO b`ã«æ¸¡ã—ã¦`IO b`ã¨ã—ã¦è¿”ã™ã€å‘½ä»¤ã‚’è¿”ã™ã€‚

å€‹äººçš„ã«ã¯ã“ã¡ã‚‰ã‚’ã‚ˆãä½¿ã†ã€‚

â†“ã®ã‚ˆã†ã«ã€æ™®é€šã®é–¢æ•°å‘¼ã³å‡ºã—ã¨åŒã˜é †ç•ªã§æ›¸ã‘ã‚‹ã‹ã‚‰ï¼

```
putStrLn =<< getLine
```

### ç•ªå¤–ç·¨: å„ç¨®æ¼”ç®—å­ã®èª­ã¿æ–¹ï¼ˆç™ºéŸ³ï¼‰

ä»Šå›èª¬æ˜ã—ãŸæ¼”ç®—å­`>>`ã¨`>>=`ã¯ã€æ¬¡ã®ã‚ˆã†ã«èª­ã¿ã¾ã™ã€‚

- `>>`: then
- `>>=`: bind

ã»ã‹ã®æ¼”ç®—å­ã«ã¤ã„ã¦ã¯<https://wiki.haskell.org/Pronunciation>ã‚’ã”è¦§ãã ã•ã„ã€‚  
